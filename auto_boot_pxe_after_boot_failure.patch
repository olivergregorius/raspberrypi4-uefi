Auto boot PXE after boot failure
---
diff --git a/Platform/RaspberryPi/Library/PlatformBootManagerLib/PlatformBm.c b/Platform/RaspberryPi/Library/PlatformBootManagerLib/PlatformBm.c
--- a/Platform/RaspberryPi/Library/PlatformBootManagerLib/PlatformBm.c	(revision d6e36a151ff8365cdc55a6914cc5e6138d5788dc)
+++ b/Platform/RaspberryPi/Library/PlatformBootManagerLib/PlatformBm.c	(date 1698878589127)
@@ -367,6 +367,12 @@
            );
   ASSERT_EFI_ERROR (Status);

+  //
+  // Connect all devices, and regenerate all boot options
+  //
+  EfiBootManagerConnectAll ();
+  EfiBootManagerRefreshAllBootOption ();
+
   BootOptions = EfiBootManagerGetLoadOptions (&BootOptionCount, LoadOptionTypeBoot);

   OptionIndex = EfiBootManagerFindLoadOption (&NewOption, BootOptions, BootOptionCount);
@@ -818,7 +824,19 @@
   //
   BootOptions = EfiBootManagerGetLoadOptions (&NewBootOptionCount,
                   LoadOptionTypeBoot);
+
+  // Always try PXE after boot failure
+  for (Index=0; Index < NewBootOptionCount; Index++) {
+    if (BootOptions[Index].FilePath->Type == MESSAGING_DEVICE_PATH &&
+      BootOptions[Index].FilePath->SubType == MSG_MAC_ADDR_DP) {
+      DEBUG ((DEBUG_WARN, "%a: trying to boot option %i\n",
+        __FUNCTION__, Index));
+      EfiBootManagerBoot (&BootOptions[Index]);
+      break;
+    }
+  }
   EfiBootManagerFreeLoadOptions (BootOptions, NewBootOptionCount);
+  return;

   //
   // If the number of configured boot options has changed, reboot
